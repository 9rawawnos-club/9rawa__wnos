<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù…ÙØµÙ†ÙØ¹ ÙÙŠØ¯ÙŠÙˆ â€” 9rawa Wnos</title>
<style>
  :root{
    --bg:#0b6623; --panel:#ffffff; --accent:#ffd23f; --muted:#666;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial;}
  body{background:linear-gradient(180deg,#072 #0b6623 80%);display:flex;align-items:center;justify-content:center;padding:20px;}
  .app{width:100%;max-width:980px;background:var(--panel);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.25);overflow:hidden;direction:rtl}
  header{background:var(--bg);color:#fff;padding:16px 20px;display:flex;align-items:center;gap:12px;justify-content:space-between}
  header h1{margin:0;font-size:20px}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:16px;padding:18px}
  .controls{padding:14px}
  label{display:block;font-weight:600;margin:10px 0 6px;color:var(--muted)}
  input[type="file"]{display:block}
  .drop{border:2px dashed #ddd;padding:18px;border-radius:8px;text-align:center;color:#444;cursor:pointer}
  ul.thumb-list{list-style:none;padding:8px;margin:12px 0;display:flex;flex-direction:column;gap:8px;max-height:320px;overflow:auto}
  li.thumb{display:flex;gap:10px;align-items:center;background:#fafafa;padding:8px;border-radius:8px;border:1px solid #eee}
  img.preview{width:86px;height:86px;object-fit:cover;border-radius:6px}
  .meta{flex:1}
  .meta input{width:60px;padding:6px}
  .buttons{display:flex;gap:8px;margin-top:12px}
  button{background:var(--bg);color:#fff;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
  button.secondary{background:#eee;color:#222}
  .stage{padding:14px;border-left:1px solid #f0f0f0}
  .canvas-wrap{background:#000;height:360px;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
  canvas{background:#000;max-width:100%}
  .preview-title{position:absolute;top:8px;left:8px;background:rgba(0,0,0,0.4);color:#fff;padding:6px 8px;border-radius:8px;font-size:13px}
  footer{padding:12px;background:#fafafa;text-align:center;color:#666;font-size:14px}
  .small{font-size:13px;color:var(--muted)}
  @media(max-width:900px){.grid{grid-template-columns:1fr;}.stage{order:-1}}
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Video slideshow maker">
    <header>
      <h1>9rawa Wnos â€” Ù…ÙØµÙ†ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</h1>
      <div class="small">Ø§Ø³Ø­Ø¨ ØµÙˆØ±ÙƒØŒ Ø±ØªØ¨Ù‡Ù…ØŒ Ø­Ù…Ù‘Ù„ ÙÙŠØ¯ÙŠÙˆ</div>
    </header>

    <div class="grid">
      <div class="controls">
        <label>Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± / Ø³Ø­Ø¨Ù‡Ø§ Ù‡Ù†Ø§</label>
        <div id="drop" class="drop">Ø§Ø³Ø­Ø¨ ÙˆØ¶Ø¹ Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
        <input id="fileInput" type="file" accept="image/*" multiple style="display:none">

        <label>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙˆØ± (Ø³Ø­Ø¨ Ù„Ù„ØªØ±ØªÙŠØ¨)</label>
        <ul id="thumbs" class="thumb-list"></ul>

        <label>Ù…Ø¯Ø© ÙƒÙ„ ØµÙˆØ±Ø© (Ø«Ø§Ù†ÙŠØ©)</label>
        <input id="duration" type="number" value="2" min="0.2" step="0.1">

        <label>Ø¯Ù‚Ù‘Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
        <select id="resolution">
          <option value="720">HD 720p</option>
          <option value="1080" selected>Full HD 1080p</option>
        </select>

        <div class="buttons">
          <button id="startBtn">ğŸ”´ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
          <button id="stopBtn" class="secondary" disabled>â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
          <button id="downloadBtn" class="secondary" disabled>â¬‡ï¸ ØªØ­Ù…ÙŠÙ„</button>
        </div>

        <p class="small" style="margin-top:10px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø§ØªØ¬ ÙŠÙƒÙˆÙ† Ø¨ØµÙŠØºØ© WebM (Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù…ØªØµÙØ­Ø§Øª Ø­Ø¯ÙŠØ«Ø©). Ø¥Ø°Ø§ ØªØ±ÙŠØ¯ MP4 Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø­ÙˆÙ„ Ø®Ø§Ø±Ø¬ÙŠ.</p>
      </div>

      <div class="stage">
        <div class="canvas-wrap">
          <div class="preview-title">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
          <canvas id="stageCanvas" width="1280" height="720"></canvas>
        </div>
        <div style="margin-top:12px;text-align:center;">
          <div id="status" class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„</div>
        </div>
      </div>
    </div>

    <footer>Ø£Ù†Ø´Ø£ Ø¨ÙˆØ§Ø³Ø·Ø© 9rawa Wnos Â· Ø§Ù†Ø³Ø® Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù„ÙˆØºÙˆ Ù„Ø¯ÙŠÙƒ Ø«Ù… Ø§Ø¶ØºØ· Ø¨Ø¯Ø¡</footer>
  </div>

<script>
(() => {
  const drop = document.getElementById('drop');
  const fileInput = document.getElementById('fileInput');
  const thumbs = document.getElementById('thumbs');
  const durationInput = document.getElementById('duration');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const canvas = document.getElementById('stageCanvas');
  const ctx = canvas.getContext('2d');
  const status = document.getElementById('status');
  const resolution = document.getElementById('resolution');

  let items = []; // {file, url, img}
  let recorder, recordedBlobs;

  // helpers
  function dataURLtoFile(dataurl, filename) {
    let arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
      bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    while(n--) u8arr[n] = bstr.charCodeAt(n);
    return new File([u8arr], filename, {type:mime});
  }

  function createThumb(file, url) {
    const li = document.createElement('li');
    li.className = 'thumb';
    li.draggable = true;

    const img = document.createElement('img');
    img.className = 'preview';
    img.src = url;

    const meta = document.createElement('div');
    meta.className = 'meta';
    meta.innerHTML = `<div style="font-weight:600">${file.name}</div>
      <div class="small">Ø§Ø³Ø­Ø¨ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ â€” Ø­Ø°Ù Ã—</div>`;

    const del = document.createElement('button');
    del.textContent = 'Ø­Ø°Ù';
    del.style.marginLeft='8px';
    del.onclick = () => {
      thumbs.removeChild(li);
      items = items.filter(i => i.url !== url);
    };

    li.appendChild(img);
    li.appendChild(meta);
    li.appendChild(del);

    // drag reorder
    li.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', url);
      li.style.opacity = '0.5';
    });
    li.addEventListener('dragend', e => { li.style.opacity='1'; });
    li.addEventListener('dragover', e => e.preventDefault());
    li.addEventListener('drop', e => {
      e.preventDefault();
      const src = e.dataTransfer.getData('text/plain');
      const dst = url;
      if (src === dst) return;
      const srcIdx = items.findIndex(i=>i.url===src);
      const dstIdx = items.findIndex(i=>i.url===dst);
      const [it] = items.splice(srcIdx,1);
      items.splice(dstIdx,0,it);
      // re-render thumbs
      renderThumbs();
    });

    return li;
  }

  function renderThumbs(){
    thumbs.innerHTML = '';
    items.forEach(i => thumbs.appendChild(createThumb(i.file, i.url)));
  }

  // file handling
  drop.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', e => handleFiles(e.target.files));
  ;['dragenter','dragover'].forEach(ev => drop.addEventListener(ev, e => { e.preventDefault(); drop.style.borderColor='#aaa'; }));
  ;['dragleave','drop'].forEach(ev => drop.addEventListener(ev, e => { e.preventDefault(); drop.style.borderColor=''; }));
  drop.addEventListener('drop', e => {
    e.preventDefault();
    const f = e.dataTransfer.files;
    handleFiles(f);
  });

  function handleFiles(fileList){
    const arr = Array.from(fileList).filter(f=>f.type.startsWith('image/'));
    if(!arr.length) return;
    arr.forEach(file=>{
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = ()=> {
        items.push({file, url, img});
        renderThumbs();
      }
      img.src = url;
    });
  }

  // drawing function (draw one image full canvas)
  async function drawImageCover(img) {
    const cw = canvas.width, ch = canvas.height;
    const iw = img.width, ih = img.height;
    // cover calculation
    const r = Math.max(cw/iw, ch/ih);
    const nw = iw * r, nh = ih * r;
    const dx = (cw - nw) / 2, dy = (ch - nh) / 2;
    ctx.clearRect(0,0,cw,ch);
    ctx.drawImage(img, dx, dy, nw, nh);
  }

  // recording slideshow
  function startRecording() {
    if (!items.length) { alert('Ø£Ø¶Ù ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹'); return; }
    startBtn.disabled = true;
    stopBtn.disabled = false;
    downloadBtn.disabled = true;
    recordedBlobs = [];
    const res = parseInt(resolution.value,10) || 1080;
    // set canvas resolution
    const targetW = res;
    const targetH = Math.round(res * 9 / 16); // 16:9
    canvas.width = targetW;
    canvas.height = targetH;
    const stream = canvas.captureStream(30); // 30 fps
    const options = {mimeType: 'video/webm; codecs=vp9'};
    try {
      recorder = new MediaRecorder(stream, options);
    } catch (e) {
      console.error(e);
      alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… MediaRecorder for webm');
      startBtn.disabled = false;
      stopBtn.disabled = true;
      return;
    }
    recorder.ondataavailable = e => { if (e.data && e.data.size) recordedBlobs.push(e.data); };
    recorder.onstop = () => {
      const superBuffer = new Blob(recordedBlobs, {type: 'video/webm'});
      const url = URL.createObjectURL(superBuffer);
      downloadBtn.href = url;
      downloadBtn.download = 'slideshow.webm';
      downloadBtn.disabled = false;
      status.textContent = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ â€” Ø­Ù…Ù‘Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ';
      startBtn.disabled = false;
      stopBtn.disabled = true;
    };
    recorder.start(200); // collect chunks each 200ms
    status.textContent = 'Ø³Ø¬Ù‘Ù„...';
    playSlides(() => {
      // Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù†ÙˆÙ‚Ù Ø§Ù„Ù…Ø³Ø¬Ù„
      setTimeout(()=>{ if(recorder && recorder.state==='recording') recorder.stop(); }, 500);
    });
  }

  // play slides to canvas sequentially and record
  function playSlides(doneCb) {
    const dur = Math.max(0.2, parseFloat(durationInput.value) || 2) * 1000;
    let idx = 0;
    function next() {
      if (idx >= items.length) { doneCb(); return; }
      const item = items[idx];
      // draw with simple zoom in effect
      const img = new Image();
      img.onload = async () => {
        // animation frames per slide
        const frames = Math.round((dur/1000) * 30);
        for (let f=0; f<frames; f++) {
          const t = f/frames;
          // zoom from 1.05 to 1.0
          const zoom = 1.05 - 0.05 * t;
          // draw with zoom
          const cw = canvas.width, ch = canvas.height;
          const iw = img.width, ih = img.height;
          const r = Math.max(cw/iw, ch/ih) * zoom;
          const nw = iw * r, nh = ih * r;
          const dx = (cw - nw) / 2, dy = (ch - nh) / 2;
          ctx.clearRect(0,0,cw,ch);
          ctx.drawImage(img, dx, dy, nw, nh);
          // small overlay text optional (index)
          ctx.fillStyle = 'rgba(0,0,0,0.15)';
          // wait next frame
          await new Promise(r=>setTimeout(r, Math.round(1000/30)));
        }
        idx++;
        next();
      };
      img.src = item.url;
    }
    next();
  }

  // events
  startBtn.addEventListener('click', startRecording);
  stopBtn.addEventListener('click', () => { if(recorder && recorder.state==='recording') recorder.stop(); stopBtn.disabled=true; status.textContent='Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙÙ„ØºÙŠ'; startBtn.disabled=false; });
  downloadBtn.addEventListener('click', () => { setTimeout(()=>URL.revokeObjectURL(downloadBtn.href), 4000); });

  // keyboard shortcuts (optional)
  window.addEventListener('keydown', e => {
    if(e.key ===' '){ e.preventDefault(); if(!startBtn.disabled) startBtn.click(); else if(!stopBtn.disabled) stopBtn.click(); }
  });

  // simple storage: keep images across refresh? (not implemented)
})();
</script>
</body>
</html>
